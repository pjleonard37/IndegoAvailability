<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>IndegoAvailability by PJLeonard37</title>

    <link rel="stylesheet" href="stylesheets/github-light.css">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src="javascripts/scale.fix.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js'></script>
    <script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css' rel='stylesheet' />
    <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css' rel='stylesheet' />

    <style>
      body { margin:0; padding:0; }
      #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">IndegoAvailability</h1>
        <p class="header">Bikes!</p>
      </header>
      <div id='map'></div>
      <script>
      L.mapbox.accessToken = 'pk.eyJ1IjoicGpsZW9uYXJkMzciLCJhIjoic2YyV2luUSJ9.lPoix24JhyR8sljAwjHg9A';
      var map = L.mapbox.map('map')
        .setView([39.95, -75.16], 9);

      var myBeaverIcon = L.icon({
      	iconUrl: 'images/beaver.png',
      	iconSize: [50, 50],
      });

      // Pull in crime data from Philly Gov
      function bikeRequest(){
        var bikeurl = 'https://www.rideindego.com/stations/json/';
        var bikedata = [];
        var crime;
        var marker;

        bikekiosks = L.layerGroup();
        $.getJSON(bikeurl, function(data) {
          var i;
          var l = data.features.length;
          for(i = 0; i < l; i++) {
            crime = data.features[i].attributes;
            marker = L.marker([data.features[i].geometry.y, data.features[i].geometry.x], {title: crime.UCR_GENERAL});
            bikekiosks.addLayer(marker);
            bikedata.push(data.features[i]);
          }
          console.log(bikedata);
          console.log(data);
        });
        // if (geography){
        //   $.getJSON(violentbikedataurl, function(data) {
        //     var i;
        //     var l = data.features.length;
        //     for (i = 0; i < l; i++) {
        //       crime = data.features[i].attributes;
        //       marker = L.marker([data.features[i].geometry.y, data.features[i].geometry.x], {title: crime.UCR_GENERAL});
        //       bikekiosks.addLayer(marker);
        //       bikedata.push(data.features[i]);
        //     }
        //   });
        // }
        return bikedata;
      };
      var dataReturned = bikeRequest();
      console.log(dataReturned);















      var damLayer = L.mapbox.featureLayer()
        .loadURL('data/DAMS.geojson')
        .addTo(map);

      damLayer.on('layeradd', function(e) {
        var marker = e.layer,
            feature = marker.feature;

        marker.setIcon(myBeaverIcon);
      });

      damLayer.on('ready', function() {
          map.fitBounds(damLayer.getBounds());
      });

      L.mapbox.styleLayer('mapbox://styles/pjleonard37/cimkxnebg00btg4ns6mw6lzgx').addTo(map);

      </script>
      <footer>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
  </body>
</html>
